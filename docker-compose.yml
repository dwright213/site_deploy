
mongodb:
  image: "mongo:3.2"
  volumes:
  - /opt/site/docker-mongo/:/data/db/
  command: "--storageEngine wiredTiger"

site:
  build: site
  links:
      - mongodb
  volumes:
    # Site code
    - ~/src/site/:/opt/site/current/
    # Ansible/shell setup code
    - ~/src/site_deploy/site/ansible/:/opt/site/ansible/
    # Virtual env
    # - /opt/site/docker-venv/:/opt/site/current/venv/    
    # Home dir
    - /opt/site/home/:/root/
    # Logs
    - /opt/site/log/:/var/log/
  environment:
    CL_MONGODB_HOST: mongodb:27017
    CL_MONGODB_USE_SSL: 'False'
  ports:
    - "0.0.0.0:80:80"
  command: 'bash /opt/site/ansible/startserver.sh'
  # command: /opt/site/current/venv/bin/uwsgi --ini /opt/site/current/configs/site_uwsgi.ini